import pandas as pd  
import numpy as np  
import glob  
import sys
import os
 
api_list = {}
eat_list = {}
dll_list = {}

for f in glob.glob('C:/Users/skand/Desktop/API_DLL/*.csv'):
    df = pd.read_csv(f)
    api = df['IAT_Name'].tolist()
    eat = df['EAT_Name'].tolist()
    dll = df['ENTRY_Name'].tolist()

    try:
        for apilist in api:
            if apilist not in api_list.keys():
                api_list[apilist] = 1
            elif apilist in api_list.keys():
                api_list[apilist] += 1
    except:
        pass

    try:
        for eatlist in eat:
            if eatlist not in eat_list.keys():
                eat_list[eatlist] = 1
            elif eatlist in eat_list.keys():
                eat_list[eatlist] += 1
    except:
        pass

    try:
        for dlllist in dll:
            if dlllist not in dll_list.keys():
                dll_list[dlllist] = 1 
            elif dlllist in dll_list.keys():
                dll_list[dlllist] += 1
    except:
        pass

API=sorted(api_list.items(), key=lambda x: x[1], reverse=True)
EAT=sorted(eat_list.items(), key=lambda x: x[1], reverse=True)
DLL=sorted(dll_list.items(), key=lambda x: x[1], reverse=True)


API_df = pd.DataFrame(API, columns = ['API_Name','Over_Lap'])
EAT_df = pd.DataFrame(EAT, columns = ['EAT_Name','Over_Lap'])
DLL_df = pd.DataFrame(DLL, columns = ['DLL_Name','Over_Lap'])

df_T = [API_df, EAT_df, DLL_df]
result = pd.concat(df_T, axis=1)

result.to_csv('2018(all)_2019(all)_2020(all)_List.csv', index = False)

