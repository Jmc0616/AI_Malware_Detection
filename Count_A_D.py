import pandas as pd
import numpy as np
import glob
import sys
import os

nor_IMP_list = {}
nor_EXP_list = {}
nor_Entry_list = {}

mal_IMP_list = {}
mal_EXP_list = {}
mal_Entry_list = {}

for f in glob.glob('C:/Users/skand/Desktop/API_DLL/*normal*.csv'):
    df1 = pd.read_csv(f)

    for i in range(len(df1)):
        if df1.iloc[i,0] not in nor_IMP_list.keys():
            nor_IMP_list[df1.iloc[i,0]] = df1.iloc[i, 1]
        elif df1.iloc[i,0] in nor_IMP_list.keys():
            nor_IMP_list[df1.iloc[i,0]] += df1.iloc[i, 1]
        if df1.iloc[i,0] not in mal_IMP_list.keys():
            mal_IMP_list[df1.iloc[i,0]] = 0

    for i in range(len(df1)):
        if df1.iloc[i,2] not in nor_EXP_list.keys():
            nor_EXP_list[df1.iloc[i,2]] = df1.iloc[i, 3]
        elif df1.iloc[i,2] in nor_EXP_list.keys():
            nor_EXP_list[df1.iloc[i,2]] += df1.iloc[i, 3]
        if df1.iloc[i,2] not in mal_EXP_list.keys():
            mal_EXP_list[df1.iloc[i,2]] = 0

    for i in range(len(df1)):
        if df1.iloc[i,4] not in nor_Entry_list.keys():
            nor_Entry_list[df1.iloc[i,4]] = df1.iloc[i, 5]
        elif df1.iloc[i,4] in nor_Entry_list.keys():
            nor_Entry_list[df1.iloc[i,4]] += df1.iloc[i, 5]
        if df1.iloc[i,4] not in mal_Entry_list.keys():
            mal_Entry_list[df1.iloc[i,4]] = 0
# api=0,1 eat=2,3 dll=4,5

for f in glob.glob('C:/Users/skand/Desktop/API_DLL/*malware*.csv'):
    df1 = pd.read_csv(f)

    for i in range(len(df1)):
        if df1.iloc[i,0] not in mal_IMP_list.keys():
            mal_IMP_list[df1.iloc[i,0]] = df1.iloc[i, 1]
        elif df1.iloc[i,0] in mal_IMP_list.keys():
            mal_IMP_list[df1.iloc[i,0]] += df1.iloc[i, 1]
        if df1.iloc[i,0] not in nor_IMP_list.keys():
            nor_IMP_list[df1.iloc[i,0]] = 0

    for i in range(len(df1)):
        if df1.iloc[i,2] not in mal_EXP_list.keys():
            mal_EXP_list[df1.iloc[i,2]] = df1.iloc[i, 3]
        elif df1.iloc[i,2] in mal_EXP_list.keys():
            mal_EXP_list[df1.iloc[i,2]] += df1.iloc[i, 3]
        if df1.iloc[i,2] not in nor_EXP_list.keys():
            nor_EXP_list[df1.iloc[i,2]] = 0

    for i in range(len(df1)):
        if df1.iloc[i,4] not in mal_Entry_list.keys():
            mal_Entry_list[df1.iloc[i,4]] = df1.iloc[i, 5]
        elif df1.iloc[i,4] in mal_Entry_list.keys():
            mal_Entry_list[df1.iloc[i,4]] += df1.iloc[i, 5]
        if df1.iloc[i,4] not in nor_Entry_list.keys():
            nor_Entry_list[df1.iloc[i,4]] = 0

# N_IAT=sorted(nor_IMP_list.items())
# N_EAT=sorted(nor_EXP_list.items())
# N_ENTRY=sorted(nor_Entry_list.items())

# M_IAT=sorted(mal_IMP_list.items())
# M_EAT=sorted(mal_EXP_list.items())
# M_ENTRY=sorted(mal_Entry_list.items())

N_IAT_df = pd.DataFrame(nor_IMP_list.items(), columns = ['IAT_Name','I_Over_Lap'])
N_EAT_df = pd.DataFrame(nor_EXP_list.items(), columns = ['EAT_Name','E_Over_Lap'])
N_ENTRY_df = pd.DataFrame(nor_Entry_list.items(), columns = ['ENTRY_Name','ENT_Over_Lap'])

M_IAT_df = pd.DataFrame(mal_IMP_list.items(), columns = ['IAT_Name','I_Over_Lap'])
M_EAT_df = pd.DataFrame(mal_EXP_list.items(), columns = ['EAT_Name','E_Over_Lap'])
M_ENTRY_df = pd.DataFrame(mal_Entry_list.items(), columns = ['ENTRY_Name','ENT_Over_Lap'])

df_T = [N_IAT_df, N_EAT_df, N_ENTRY_df, M_IAT_df, M_EAT_df, M_ENTRY_df]
API_result = pd.concat(df_T, axis=1)

API_result.to_csv('2018(all).csv', index=False)